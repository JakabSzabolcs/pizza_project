<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets" lang="en">
<h:head>
    <title>User Page</title>
    <h:outputStylesheet library="css" name="styles.css"/>
    <p:outputLabel value="Welcome #{loginMBean.loggedInUser.username}"/>
</h:head>
<h:body>
    <h:form id="mainForm">
        <p:commandButton value="Logout">
            <p:ajax event="click" listener="#{loginMBean.logout()}" update="@form"/>
        </p:commandButton>

        <h3>Add New Order</h3>
        <p:panelGrid columns="2">
            <p:outputLabel for="pizza" value="Pizza:"/>
            <p:selectOneMenu value="#{orderPizzaMBean.selectedPizza}" converter="pizzaConverter" id="pizza">
                <f:selectItem noSelectionOption="true" itemDisabled="true" itemValue="#{null}"
                              itemLabel="Please choose!"/>
                <f:selectItems value="#{orderPizzaMBean.list}" var="pizza" itemLabel="#{pizza.name}"
                               itemValue="#{pizza.id}"/>
            </p:selectOneMenu>

            <p:commandButton value="Add Pizza" actionListener="#{orderPizzaMBean.addPizzaToOrder()}"
                             update=":mainForm"/>
        </p:panelGrid>
        <p:outputLabel value="Current order:"/>
        <p:dataTable id="currentOrderTable" var="pizza" value="#{orderPizzaMBean.currentOrder.pizzas}"
                     paginator="true" rows="10" styleClass="mt-2"
                     paginatorPosition="bottom">
            <p:column>
                <f:facet name="Name">
                    <h:outputText value="Name"/>
                </f:facet>
                <h:outputText value="#{pizza.name}"/>
            </p:column>
            <p:column>
                <f:facet name="Details">
                    <h:outputText value="Details"/>
                </f:facet>
                <h:outputText value="#{pizza.details}"/>
            </p:column>
            <p:column>
                <f:facet name="Price">
                    <h:outputText value="Price"/>
                </f:facet>
                <h:outputText value="#{pizza.price}"/>
            </p:column>
            <p:column>
                <f:facet name="Delete">
                    <h:outputText value="Delete"/>
                </f:facet>
                <p:commandButton value="Delete" actionListener="#{orderPizzaMBean.removePizzaFromOrder(pizza)}"
                                 update=":mainForm"/>
            </p:column>
        </p:dataTable>

        <p:commandButton value="Place Order" update=":mainForm" oncomplete="PF('informationsDialog').show()"/>

        <p:outputLabel value="Your orders:"/>
        <p:dataTable id="orderTable" var="order" value="#{orderPizzaMBean.orderListOfCurrentUser}"
                     paginator="true" rows="10" styleClass="mt-2"
                     paginatorPosition="bottom">
            <p:column>
                <f:facet name="Name">
                    <h:outputText value="Id"/>
                </f:facet>
                <h:outputText value="#{order.id}"/>
            </p:column>
            <p:column>
                <f:facet name="Details">
                    <h:outputText value="Delivery Date"/>
                </f:facet>
                <h:outputText value="#{order.deliveryDate}"/>
            </p:column>

            <p:column>
                <f:facet name="phonenumber">
                    <h:outputText value="Courier's phonenumber"/>
                </f:facet>
                <h:outputText
                        value="#{order.courier.phoneNumber != null ? order.courier.phoneNumber : 'This order has no courier yet.'}"/>
            </p:column>
        </p:dataTable>



    </h:form>

    <h:form id="pizzaForm">
        <p:dialog modal="true" id="informationsDialog" widgetVar="informationsDialog" closable="true"
                  style="margin-inside: 10px">
            <p:panelGrid columns="2" id="formPanel" layout="grid">
                <p:outputLabel for="city" value="City"/>
                <p:inputText id="city" value="#{orderPizzaMBean.currentOrder.city}"/>
                <p:outputLabel for="street" value="Street"/>
                <p:inputText id="street" value="#{orderPizzaMBean.currentOrder.street}"/>
                <p:outputLabel for="streetType" value="Street Type"/>
                <p:selectOneMenu id="streetType" value="#{orderPizzaMBean.currentOrder.streetType}">
                    <f:selectItem itemLabel="utca" itemValue="utca"/>
                    <f:selectItem itemLabel="köz" itemValue="köz"/>
                    <f:selectItem itemLabel="lugas" itemValue="lugas"/>
                </p:selectOneMenu>
                <p:outputLabel for="houseNumber" value="House Number"/>
                <p:inputText id="houseNumber" value="#{orderPizzaMBean.currentOrder.houseNumber}"/>
                <p:outputLabel for="deliveryDate" value="Delivery Date"/>
                <p:calendar id="deliveryDate" value="#{orderPizzaMBean.currentOrder.deliveryDate}"/>
                <p:commandButton value="Done" process="formPanel" validateClient="true"
                                 actionListener="#{orderPizzaMBean.saveOrder}" update=":mainForm"
                                 oncomplete="PF('informationsDialog').hide()"/>
            </p:panelGrid>
        </p:dialog>
    </h:form>
</h:body>
</html>
